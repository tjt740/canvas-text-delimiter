<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>demo</title>
        <link
            href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <style>
            body {
                padding: 20px;
            }
            #container {
                padding: 16px;
                border: 1px solid #999;
                border-radius: 4px;
                line-height: 1.8;
            }
        </style>
    </head>
    <body>
        <p class="h4">尝试在下方进行划词高亮</p>
        <section>
            <div id="container">
                <p style="text-align: center">
                    <span style="font-size: 22px; font-weight: bold">匆匆</span>
                </p>
                <p style="text-align: center">
                    <span style="font-weight: bold">朱自清</span>
                </p>
                <p>
                    燕子去了，有再来的时候杨柳枯了，有再青的时候桃花谢了，有再开的时候。但是聪明的你告诉我，我们的日子为什么一去不复返呢？是有人偷了他
                    们罢：那是谁？又藏在何处呢？是他们自己逃走了罢如今又到了哪里呢？
                </p>
                <p>
                    我不知道他们给了我多少日子，但我的手
                    <span style="font-size: 20px; color: #f56c6c">确乎</span>
                    是渐渐
                    <span style="font-size: 20px; color: #f56c6c">空虚</span>
                    了。在默默里算着，八千多日子已经从我手中溜去，像针尖上一滴水滴在大海里，我的日子滴在时间的流里，没有声音，也没有影子。我不禁头
                    <span style="font-size: 20px; color: #f56c6c">涔涔</span>
                    而泪
                    <span style="font-size: 20px; color: #f56c6c">潸潸</span>
                    了。去的尽管去了，来的尽管来着，去来的中间，又怎样地匆匆呢？
                </p>
                <p>
                    早上我起来的时候，小屋里射进两三方斜斜的太阳。太阳他有脚啊，轻轻悄悄地挪移了，我也茫茫然跟着旋转。于是洗手的时候，日子从水盆里过去，吃饭的时候，日子从饭碗里过去，默默时，便从凝然的双眼前过去。我觉察他去的匆匆了，伸出手遮挽时，他又从遮挽着的手边过去。
                </p>
                <p>
                    天黑时，我躺在床上，他便
                    <span style="font-size: 20px; color: #f56c6c">
                        伶伶俐俐
                    </span>
                    地从我身上跨过，从我脚边飞去了。等我睁开眼和太阳再见，这算又溜走了一日。我掩着面叹息。但是新来的日子的影儿又开始在叹息里闪过了。在逃去如飞的日子里，在千门万户的世界里的我能做些什么呢？
                </p>
                <p>
                    只有
                    <span style="font-size: 20px; color: #f56c6c">
                        徘徊罢了
                    </span>
                    ，只有匆匆罢了，在八千多日的匆匆里，除徘徊外，又剩些什么呢？过去的日子如轻烟，被微风吹散了，如薄雾，被初阳蒸融了。我留着些什么痕迹呢？我何曾留着像
                    <span style="font-size: 20px; color: #f56c6c">游丝</span>
                    样的痕迹呢？
                </p>
                <p>
                    我赤裸裸来到这世界，转眼间也将赤裸裸的回去罢？但不能平的，为什么偏要白白走这一遭啊？你聪明的，告诉我，我们的日子为什么一去不复返呢？
                </p>
            </div>
            <button
                class="btn btn-primary btn-sm action"
                style="position: absolute; display: none"
                type="button"
            >
                高亮
            </button>
        </section>
        <script src="https://unpkg.com/canvas-highlighter/lib/index.iife.js"></script>
        <script>
            const btn = document.querySelector('.action');
            let range = null;

            // 获取文本容器元素
            const container = document.getElementById('container');
            // 创建 CanvasHighlighter 实例
            const highlighter = new CanvasHighlighter(container);

            // 监听容器元素鼠标抬起事件
            container.addEventListener('mouseup', () => {
                // 获取当前划词选中的 range 对象
                range = highlighter.getSelectionRange();

                if (range) {
                    // 获取划词区域最后一个节点位置
                    const { end } = highlighter.getSelectionPosition();

                    // 设置高亮按钮位置
                    const scrollTop = document.documentElement.scrollTop;
                    btn.style.top = end.y - 35 + scrollTop + 'px';
                    btn.style.left = end.x + 4 + 'px';
                    btn.style.display = 'inline-block';
                }
            });

            btn.addEventListener('click', () => {
                // 高亮选中区域
                if (range) highlighter.addRange(range);

                btn.style.display = 'none';
                window.getSelection().removeAllRanges();
            });
        </script>
    </body>
</html>
